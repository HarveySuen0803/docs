# OSI

OSI（Open Systems Interconnection）模型是一个标准化的七层框架，用于理解和设计网络系统的通信。每一层都有特定的功能，这些层之间通过接口和协议进行互动。

OSI 七层模型：

1. 物理层（Physical Layer）：

- 功能：负责传输原始的比特流（0和1），定义硬件设备的电气、机械和功能规范，如电缆、网卡、集线器等。
- 数据单位：比特（Bit）

2. 数据链路层（Data Link Layer）:

- 功能：建立、维护和释放数据链路，负责帧的传输和错误检测（如MAC地址的使用）。
- 数据单位：帧（Frame）

3. 网络层（Network Layer）:

- 功能：进行数据包的路由选择和转发，负责网络路径的选择（如IP地址）。
- 数据单位：数据包（Packet）

4. 传输层（Transport Layer）:

- 功能：建立端到端的连接，提供可靠的数据传输服务（如TCP/UDP协议）。
- 数据单位：报文段（Segment，TCP）/数据报（Datagram，UDP）

5. 会话层（Session Layer）:

- 功能：管理会话，负责建立、维护和终止会话（如RPC协议）。
- 数据单位：数据（Data）

6. 表示层（Presentation Layer）:

- 功能：数据格式化、加密/解密、压缩/解压缩（如JPEG、MPEG）。
- 数据单位：数据（Data）

7. 应用层（Application Layer）:

- 功能：提供应用服务和接口，如文件传输、电子邮件、虚拟终端（如HTTP、FTP、SMTP）。
- 数据单位：数据（Data）

![](https://note-sun.oss-cn-shanghai.aliyuncs.com/image/202406221145656.png)

# Network Layer

Network Layer 的核心功能是实现数据在多个网络之间的传输和路由选择，确保数据包从源节点传输到目标节点。

假设数据包从 Sender 传到 Receiver，需要经过两个路由器 Rrouter1 和 Router2

1. 发送方 Sender

- 应用层产生数据，逐层向下传递，最终网络层封装成 IP 数据包。
- 数据链路层将 IP 数据包封装成帧，并通过物理层传输到路由器 Router1。

2. 中间路由 Router1

- 物理层接收到以太网帧，传递给数据链路层。
- 数据链路层解析出 IP 数据包，进行 CRC 校验，校验成功后传递给网络层。
- 网络层解析 IP 数据包头，查找路由表，找到下一跳 Router2 的 IP 地址。

3. 中间路由 Router2

- 物理层接收到以太网帧，传递给数据链路层。
- 数据链路层解析出 IP 数据包，进行 CRC 校验，校验成功后传递给网络层。
- 网络层解析 IP 数据包头，查找路由表，找到下一跳 Receiver 的 IP 地址。

4. 接收方 Receiver

- 物理层接收到以太网帧，传递给数据链路层。
- 数据链路层解析出 IP 数据包，进行 CRC 校验，校验成功后传递给网络层。
- 网络层解析 IP 数据包头，再逐渐向上传递到应用层。

MAC 地址是物理地址，与网络设备的网卡绑定，是全球唯一的。MAC地址是数据链路层的地址，它在局域网（LAN）内用于标识物理设备。但是，MAC地址在不同的网络之间没有全局意义。

MAC 地址用于局域网内部的通信，设备通过交换机（或桥接器）使用 MAC 地址进行通信。数据链路层协议（例如以太网协议）使用 MAC 地址来识别同一网络中的设备。

IP 地址是逻辑地址，可以动态分配，便于组织和管理。IP地址是网络层的地址，用于在不同网络之间标识设备。IP地址具备层次性，可用于高效路由。

IP 地址用于不同网络之间的通信，设备通过路由器使用 IP 地址进行通信。网络层协议（例如 IP 协议）使用 IP 地址来标识网络设备，并通过路由选择路径。

MAC 地址在局域网内部唯一即可，但在规模巨大的互联网中，单靠 MAC 地址难以实现全局唯一和有效的路由。

IP 地址是经过设计的层次结构，包括网络部分和主机部分，这使得路由器能够根据网络部分高效路由和转发数据包。路由器仅需检查 IP 包头中的网络部分来决定转发路径，而无需关心具体设备的 MAC 地址。

MAC 地址和 IP 地址的协作流程：

1. 设备的初始通信：

- 当一个设备（例如你的计算机）要与另一个设备（例如一台服务器）进行通信时，会首先生成相应的数据。应用层协议（如 HTTP）生成请求数据，然后逐层向下传递，最终形成一个包含目的 IP 地址的数据包。

2. 数据包的局域网传输：

- 数据包在网络层封装为 IP 数据包，并传递到数据链路层。数据链路层需要将 IP 数据包封装为帧，并包含源 MAC 地址和目的 MAC 地址。

3. ARP 地址解析协议：

- 在本地局域网内，发送设备使用 ARP 协议将目的 IP 地址解析成相应的 MAC 地址，确保帧能准确传递到目标设备或下一个路由器。
- 如果没有对应的 ARP 缓存条目，设备会广播 ARP 请求，询问谁拥有这个 IP 地址的 MAC 地址。

4. 发送数据到路由器：

- 通过 ARP，从局域网中接收到响应，获取目标 MAC 地址。数据链路层封装帧后，通过物理层传输到第一个路由器。

5. 跨越路由器传输数据包：

- 路由器从物理层接收到帧，传递到数据链路层进行解封装，提取出 IP 数据包。
- 路由器检查数据包头中的目标 IP 地址，并使用路由表查找最佳的下一跳路径。
  - 根据路由表，路由器确定下一跳路由器或最终目标网络。
  - 路由器通过 ARP 解析下一跳设备的 MAC 地址，将 IP 数据包再封装成数据链路层帧。
  - 帧通过物理层传输到下一跳路由器。
- 重复上述 hop-by-hop 的逐跳过程，IP 数据包在经过多个路由器的中继后，最终传送到目标局域网内的最后一个路由器。

6. 目标局域网的传输：

- 最后一个路由器接收到数据帧进行解封装，提取出 IP 数据包。
- 路由器再次检查目标 IP 地址，如果目标 IP 地址属于本地局域网，则通过数据链路层进行最终传送。
- 使用 ARP 从本地网络解析出目标设备的 MAC 地址。
- 路由器将 IP 数据包封装成数据帧，通过局域网络传递给目标设备。

7. 目标设备接收数据包：

- 目标设备解封装数据帧，提取出 IP 数据包并逐层向上解析，最终将数据交付给应用层处理。

# Transport Layer

Transport Layer 主要作用是在端到端的通信过程中，提供可靠或不可靠的数据传输服务，确保数据从源主机传送到目标主机的特定应用进程。

